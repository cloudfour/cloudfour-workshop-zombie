<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Frameworks (jQuery Mobile) and localStorage">
  <title>A Band of Brothers</title>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="../assets/styles/speaker.css">
</head>
<body>
<header>
<h1 class="title">A Band of Brothers</h1>
<h2 class="author">Frameworks (jQuery Mobile) and localStorage</h2>
</header>
<section class="level1" id="i-got-one">
<h1>I got one!</h1>
<figure>
<img src="images/06-3ws.png"><figcaption></figcaption>
</figure>
<p>Sigma Stronghold leaders want a way for agents in the field to be able to record their zombie kills.</p>
<p>Each time a soldier nabs a zombie out there, he or she should be able to record when, where and how that zombie met its fate. Kind of like a zombie kill board.</p>
</section>
<section class="level1" id="frameworks">
<h1>Frameworks</h1>
<section class="level2" id="so-how-do-we-build-something-like-this">
<h2>So, how do we build something like this?</h2>
<p>Sometimes you don't want to keep re-inventing the same zombie-blasting cannon over and over again. We zombie fighters might be a ragtag bunch, but we stick together.</p>
<p>Frameworks, libraries, tools, templates...all of these can give you a leg up.</p>
</section>
</section>
<section class="level1" id="jquery-mobile">
<h1>jQuery Mobile</h1>
<figure>
<img src="images/06-jquerymobile-com.png"><figcaption></figcaption>
</figure>
<p>jQuery Mobile is a mobile web framework built atop the popular jQuery library.</p>
<p>jQuery Mobile works hand-in-hand with semantic HTML5 markup.</p>
</section>
<section class="level1" id="building-with-jquery-mobile">
<h1>Building with jQuery Mobile</h1>
<p>Content and applications with jQuery Mobile are constructed from:</p>
<ul>
<li>Rather basic HTML5 markup.</li>
<li>The inclusion of the jQuery core JavaScript library, the jQuery Mobile JS and the jQuery Mobile CSS.</li>
<li>You can build on this with your own JavaScript, as you please.</li>
</ul>
</section>
<section class="level1" id="structure-of-jquery-mobile-page">
<h1>Structure of jQuery Mobile Page</h1>
<section class="level2" id="code">
<h2>Code</h2>
<pre class="sourceCode html"><code class="sourceCode html"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span> 
<span class="kw">&lt;html&gt;</span> 
    <span class="kw">&lt;head&gt;</span> 
    <span class="kw">&lt;title&gt;</span>I Got One!<span class="kw">&lt;/title&gt;</span> 
    <span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">&quot;viewport&quot;</span><span class="ot"> content=</span><span class="st">&quot;width=device-width, initial-scale=1, maximum-scale=1&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href=</span><span class="st">&quot;http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.css&quot;</span> <span class="kw">/&gt;</span>
    <span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="ot"> src=</span><span class="st">&quot;http://code.jquery.com/jquery-1.6.4.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
    <span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="ot"> src=</span><span class="st">&quot;http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
<span class="kw">&lt;/head&gt;</span>
<span class="kw">&lt;body&gt;</span> 

<span class="kw">&lt;div</span><span class="ot"> data-role=</span><span class="st">&quot;page&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;div</span><span class="ot"> data-role=</span><span class="st">&quot;header&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;/div&gt;</span>

  <span class="kw">&lt;div</span><span class="ot"> data-role=</span><span class="st">&quot;content&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;/div&gt;</span>
<span class="kw">&lt;/div&gt;</span>

<span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre>
</section>
<section class="level2" id="speaker-notes">
<h2>Speaker Notes</h2>
<ul>
<li>Note the maximum-scale zoom thing here</li>
</ul>
</section>
</section>
<section class="level1" id="jquery-mobile-page-structure">
<h1>jQuery Mobile Page Structure</h1>
<figure>
<img src="images/06-jqm.png"><figcaption></figcaption>
</figure>
<ul>
<li>Delineated by HTML5 <code>data-</code> attributes.</li>
<li>Enables content loading via AJAX.</li>
</ul>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;div</span><span class="ot"> data-role=</span><span class="st">&quot;page&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;div</span><span class="ot"> data-role=</span><span class="st">&quot;header&quot;</span><span class="kw">&gt;&lt;/div&gt;</span>
  <span class="kw">&lt;div</span><span class="ot"> data-role=</span><span class="st">&quot;content&quot;</span><span class="kw">&gt;&lt;/div&gt;</span>
  <span class="kw">&lt;div</span><span class="ot"> data-role=</span><span class="st">&quot;footer&quot;</span><span class="kw">&gt;&lt;/div&gt;</span>
<span class="kw">&lt;/div&gt;</span></code></pre>
</section>
<section class="level1" id="relying-on-our-bros">
<h1>Relying on our bros</h1>
<section class="level2" id="code-1">
<h2>Code</h2>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">&quot;viewport&quot;</span><span class="ot"> content=</span><span class="st">&quot;width=device-width, initial-scale=1, maximum-scale=1&quot;</span><span class="kw">&gt;</span>
<span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href=</span><span class="st">&quot;http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.css&quot;</span> <span class="kw">/&gt;</span>
<span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="ot"> src=</span><span class="st">&quot;http://code.jquery.com/jquery-1.6.4.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
<span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="ot"> src=</span><span class="st">&quot;http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
<span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;date.format.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
<span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;http://code.google.com/apis/gears/gears_init.js&quot;</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
<span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;geo.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
<span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;zombie.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></code></pre>
<ul>
<li><code>date.format.js</code> (Date.format) lets us do much easier date formatting with JavaScript.</li>
<li>Using Google Gears and the <code>geo-location-js</code> library makes cross-platform geolocation a snap.</li>
</ul>
</section>
</section>
<section class="level1" id="ok-lets-go">
<h1>OK, let's go!</h1>
<p>Find the starting point for the &quot;I got one!&quot; web app in your rucksack, in the <code>i-got-one</code> folder. Go ahead and open <code>index.html</code> in your text editor.</p>
<section class="level3" id="our-mission">
<h3>Our mission</h3>
<p>The starting point is an empty jQuery Mobile page. We'll need to:</p>
<ol type="1">
<li>Add a header to see how jQM automatically styles stuff for us.</li>
<li>Drop in some user interface elements so soldiers can enter their nabbed zombies.</li>
<li>Add some custom JavaScript</li>
</ol>
</section>
</section>
<section class="level1" id="add-a-header">
<h1>Add a header</h1>
<p>At the outset, our jQM page is empty. Let's put some stuff in it.</p>
<ul>
<li>This is in the <code>&lt;div data-role=&quot;header&quot;&gt;</code>.</li>
<li>jQuery Mobile's CSS and JS will stye this into a (rather iOS-esque) header element.</li>
</ul>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;div</span><span class="ot"> data-role=</span><span class="st">&quot;header&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;h1&gt;</span>I got one!<span class="kw">&lt;/h1&gt;</span>
<span class="kw">&lt;/div&gt;</span></code></pre>
<section class="level5" id="index.html">
<h5>index.html</h5>
</section>
<section class="level3" id="try-it-out">
<h3>Try it out!</h3>
</section>
</section>
<section class="level1" id="et-voila">
<h1>Et Voila!</h1>
<section class="level2" id="figure-a-header-in-jqm">
<h2>Figure: A header in jQM</h2>
<figure>
<img src="images/06-header.png"><figcaption></figcaption>
</figure>
</section>
</section>
<section class="level1" id="putting-the-form-in">
<h1>Putting the &quot;Form&quot; In</h1>
<figure>
<img src="images/06-starting-point.png"><figcaption></figcaption>
</figure>
<p>Easy, but not too exciting. Let's put in some UI elements that will let Sigma Stronghold fighters record a nabbed zombie.</p>
</section>
<section class="level1" id="how-do-we-do-that">
<h1>How do we do that?</h1>
<p>First, let's add a <code>&lt;select&gt;</code> element, just like you would do for any HTML form (except in our case, we don't have a containing form). Add this to the <code>&lt;div data-role=&quot;content&quot;&gt;</code> area.</p>
<section class="level2" id="code-2">
<h2>Code</h2>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;div</span><span class="ot"> data-role=</span><span class="st">&quot;content&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;div</span><span class="ot"> data-role=</span><span class="st">&quot;fieldcontain&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;label</span><span class="ot"> for=</span><span class="st">&quot;how-zombie&quot;</span><span class="kw">&gt;</span>How&#39;d you nab it?<span class="kw">&lt;/label&gt;</span>
    <span class="kw">&lt;select</span><span class="ot"> name=</span><span class="st">&quot;how-zombie&quot;</span><span class="ot"> id=</span><span class="st">&quot;how-zombie&quot;</span><span class="kw">&gt;</span>
      <span class="kw">&lt;option</span><span class="ot"> value=</span><span class="st">&quot;tank&quot;</span><span class="kw">&gt;</span>Tank<span class="kw">&lt;/option&gt;</span>
      <span class="kw">&lt;option</span><span class="ot"> value=</span><span class="st">&quot;conflagration&quot;</span><span class="kw">&gt;</span>Conflagration<span class="kw">&lt;/option&gt;</span>
      <span class="kw">&lt;option</span><span class="ot"> value=</span><span class="st">&quot;poison&quot;</span><span class="kw">&gt;</span>Poison<span class="kw">&lt;/option&gt;</span>
      <span class="kw">&lt;option</span><span class="ot"> value=</span><span class="st">&quot;nukes&quot;</span><span class="kw">&gt;</span>Micro-nukes<span class="kw">&lt;/option&gt;</span>
      <span class="kw">&lt;option</span><span class="ot"> value=</span><span class="st">&quot;trickery&quot;</span><span class="kw">&gt;</span>Trickery<span class="kw">&lt;/option&gt;</span>
      <span class="kw">&lt;option</span><span class="ot"> value=</span><span class="st">&quot;corrosive&quot;</span><span class="kw">&gt;</span>Corrosive<span class="kw">&lt;/option&gt;</span>
      <span class="kw">&lt;option</span><span class="ot"> value=</span><span class="st">&quot;dismemberment&quot;</span><span class="kw">&gt;</span>Dismemberment<span class="kw">&lt;/option&gt;</span>
    <span class="kw">&lt;/select&gt;</span>
  <span class="kw">&lt;/div&gt;</span> 

<span class="kw">&lt;/div&gt;</span></code></pre>
</section>
</section>
<section class="level1" id="now-well-add-a-button">
<h1>Now, we'll add a button</h1>
<ul>
<li>Again, jQuery Mobile will create a styled, mobile-ish button from this <code>&lt;input&gt;</code> field.</li>
</ul>
<section class="level2" id="code-3">
<h2>Code</h2>
<pre class="sourceCode html"><code class="sourceCode html">      <span class="kw">&lt;option</span><span class="ot"> value=</span><span class="st">&quot;dismemberment&quot;</span><span class="kw">&gt;</span>Dismemberment<span class="kw">&lt;/option&gt;</span>
    <span class="kw">&lt;/select&gt;</span>
  <span class="kw">&lt;/div&gt;</span> 
  <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;button&quot;</span><span class="ot"> value=</span><span class="st">&quot;I got one!&quot;</span><span class="ot"> id=</span><span class="st">&quot;got-one&quot;</span><span class="ot"> data-theme=</span><span class="st">&quot;b&quot;</span> <span class="kw">/&gt;</span>
<span class="kw">&lt;/div&gt;</span></code></pre>
</section>
</section>
<section class="level1" id="dead-zombie-storage">
<h1>Dead Zombie Storage</h1>
<p>When a soldier nabs a zombie by tapping the &quot;I Got One!&quot; button, we'll need a place to display the info about that poor zombie. For each zombie nabbed, we'll add a row to a <code>&lt;ul&gt;</code>. Let's create an empty <code>&lt;ul&gt;</code> to hold those incoming zombies. Put this at the very bottom of the <code>&lt;div data-role=&quot;content&quot;&gt;</code></p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;/div&gt;</span> 
<span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;button&quot;</span><span class="ot"> value=</span><span class="st">&quot;I got one!&quot;</span><span class="ot"> id=</span><span class="st">&quot;got-one&quot;</span><span class="ot"> data-theme=</span><span class="st">&quot;b&quot;</span> <span class="kw">/&gt;</span>
<span class="kw">&lt;ul</span><span class="ot"> data-role=</span><span class="st">&quot;listview&quot;</span><span class="ot"> data-inset=</span><span class="st">&quot;true&quot;</span><span class="ot"> id=</span><span class="st">&quot;zombielist&quot;</span><span class="kw">&gt;</span>
<span class="kw">&lt;/ul&gt;</span>
<span class="kw">&lt;/div&gt;</span> <span class="co">&lt;!-- /End &lt;div data-role=&quot;content&quot;&gt; --&gt;</span></code></pre>
<p><code>data-role=&quot;listview&quot;</code> indicates to jQuery Mobile that this list should be styled as a list widget.</p>
</section>
<section class="level1" id="a-list-widget-what-now">
<h1>A list widget what now?</h1>
<section class="level3" id="jquery-mobile-turns-this">
<h3>jQuery Mobile Turns This</h3>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;ul</span><span class="ot"> data-role=</span><span class="st">&quot;listview&quot;</span><span class="ot"> data-inset=</span><span class="st">&quot;true&quot;</span><span class="ot"> id=</span><span class="st">&quot;zombielist&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;li&gt;&lt;img</span><span class="ot"> src=</span><span class="st">&quot;icons/z2.png&quot;</span><span class="ot"> alt=</span><span class="st">&quot;Killed by micro-nukes&quot;</span> <span class="kw">/&gt;&lt;h3&gt;</span>Zombie Nabbed!<span class="kw">&lt;/h3&gt;</span>
  <span class="kw">&lt;p&gt;&lt;strong&gt;</span>01/18/12 13:44<span class="kw">&lt;/strong&gt;&lt;/p&gt;</span>
  <span class="kw">&lt;p&gt;</span>Coordinates: 40.7678494, -73.9853328<span class="kw">&lt;/p&gt;&lt;/li&gt;</span>
<span class="kw">&lt;/ul&gt;</span></code></pre>
</section>
<section class="level3" id="into-this">
<h3>Into this</h3>
<figure>
<img src="images/06-li-example.png"><figcaption></figcaption>
</figure>
</section>
</section>
<section class="level1" id="and-now-we-have-a-starting-point">
<h1>And now we have a starting point</h1>
<section class="level2" id="figure-screen-shot-of-our-current-page">
<h2>Figure: Screen shot of our current page</h2>
<figure>
<img src="images/06-starting-point.png"><figcaption></figcaption>
</figure>
</section>
</section>
<section class="level1" id="a-quick-aside-about-browser-support">
<h1>A quick aside about browser support</h1>
<figure>
<img src="images/06-no-js.png"><figcaption></figcaption>
</figure>
<ul>
<li>By its nature, jQuery Mobile practices enthusiastic progressive enhancement</li>
<li>jQuery Mobile works in browsers that do not support JavaScript</li>
<li>However, our functionality requirements for the &quot;I got one!&quot; app effectively require JavaScript</li>
</ul>
</section>
<section class="level1" id="warning-javascript-ahead">
<h1>Warning: JavaScript ahead</h1>
<section class="level2" id="figure-alert">
<h2>Figure: ALERT!</h2>
<figure>
<img src="images/06-alert.png"><figcaption></figcaption>
</figure>
</section>
</section>
<section class="level1" id="adding-the-javascript">
<h1>Adding the JavaScript</h1>
<p>Now we can drop in some custom JavaScript that makes this go:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;zombie.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></code></pre>
<p>The curious can open up <code>zombie.js</code> and follow along as I confuse you through the next several slides!</p>
</section>
<section class="level1" id="working-with-jquery-mobile-events">
<h1>Working with jQuery Mobile events</h1>
<ul>
<li>When the page is done loading and the widgets have been marked up...
<ul>
<li>Check for geolocation support</li>
<li>Add a click handler for the &quot;I Got One!&quot; button</li>
</ul></li>
</ul>
<pre class="sourceCode javascript"><code class="sourceCode javascript">$(<span class="st">&quot;#nab-zombie&quot;</span>).<span class="fu">live</span>(<span class="ch">&#39;pageinit&#39;</span>, <span class="kw">function</span>() {
  <span class="co">// Is Geolocation supported?</span>
  <span class="kw">var</span> geoHappy = <span class="kw">geo_position_js</span>.<span class="fu">init</span>();
  <span class="co">// Click handler for the &quot;Got One&quot; button</span>
  $(<span class="st">&quot;#got-one&quot;</span>).<span class="fu">click</span>(<span class="kw">function</span>() {

  });
});</code></pre>
</section>
<section class="level1" id="more-about-that-click-handler">
<h1>More about that click handler</h1>
<ul>
<li>Need to organize the info that will populate our zombie <code>&lt;li&gt;</code></li>
<li>Where, when and how...</li>
</ul>
<pre class="sourceCode javascript"><code class="sourceCode javascript">$(<span class="st">&quot;#got-one&quot;</span>).<span class="fu">click</span>(<span class="kw">function</span>() {
  <span class="co">// A Date object (will default to right now)</span>
  <span class="kw">var</span> now = <span class="kw">new</span> <span class="kw">Date</span>();
  <span class="co">// What&#39;s the value of the #how-zombie &lt;select&gt;?</span>
  <span class="kw">var</span> how = $(<span class="st">&quot;#how-zombie&quot;</span>).<span class="fu">val</span>();
  <span class="kw">if</span> (geoHappy) { <span class="co">// Get position data if supported</span>

  } <span class="kw">else</span> { <span class="co">// It&#39;s also OK to add a zombie w/o location data</span>

  }
});</code></pre>
</section>
<section class="level1" id="fleshing-it-out...">
<h1>Fleshing it out...</h1>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">if</span> (geoHappy) {
  <span class="co">// Get the current position (just like with W3C API)</span>
  <span class="kw">geo_position_js</span>.<span class="fu">getCurrentPosition</span>(<span class="kw">function</span>(position) {
    <span class="kw">zombieManager</span>.<span class="fu">addZombie</span>(now, position, how);
  }, <span class="kw">function</span>(error) {
    <span class="kw">console</span>.<span class="fu">log</span>(<span class="st">&quot;Geolocation error: &quot;</span> + <span class="kw">error</span>.<span class="fu">message</span>);
    <span class="kw">zombieManager</span>.<span class="fu">addZombie</span>(now, null, how);
  });
} <span class="kw">else</span> { <span class="co">// It&#39;s also OK to add a zombie w/o location data</span>
  <span class="kw">zombieManager</span>.<span class="fu">addZombie</span>(now, null, how);
}</code></pre>
<p>We'll talk about <code>zombieManager</code> in just a moment.</p>
</section>
<section class="level1" id="all-together-now">
<h1>All together now</h1>
<section class="level2" id="code-4">
<h2>Code</h2>
<pre class="sourceCode javascript"><code class="sourceCode javascript">$(<span class="st">&quot;#nab-zombie&quot;</span>).<span class="fu">live</span>(<span class="ch">&#39;pageinit&#39;</span>, <span class="kw">function</span>() {
  <span class="co">// Is Geolocation supported?</span>
  <span class="kw">var</span> geoHappy = <span class="kw">geo_position_js</span>.<span class="fu">init</span>();
  <span class="co">// Click handler for the &quot;Got One&quot; button</span>
  $(<span class="st">&quot;#got-one&quot;</span>).<span class="fu">click</span>(<span class="kw">function</span>() {
    <span class="kw">var</span> now = <span class="kw">new</span> <span class="kw">Date</span>();
    <span class="kw">var</span> how = $(<span class="st">&quot;#how-zombie&quot;</span>).<span class="fu">val</span>();
    <span class="co">// Get position data if supported</span>
    <span class="kw">if</span> (geoHappy) {
      <span class="kw">geo_position_js</span>.<span class="fu">getCurrentPosition</span>(<span class="kw">function</span>(position) {
        <span class="kw">zombieManager</span>.<span class="fu">addZombie</span>(now, position, how);
      }, <span class="kw">function</span>(error) {
        <span class="kw">console</span>.<span class="fu">log</span>(<span class="st">&quot;Geolocation error: &quot;</span> + <span class="kw">error</span>.<span class="fu">message</span>);
        <span class="kw">zombieManager</span>.<span class="fu">addZombie</span>(now, null, how);
      });
    } <span class="kw">else</span> { <span class="co">// It&#39;s also OK to add a zombie w/o location data</span>
      <span class="kw">zombieManager</span>.<span class="fu">addZombie</span>(now, null, how);
    }
  });
});</code></pre>
</section>
</section>
<section class="level1" id="managing-our-zombies">
<h1>Managing our Zombies</h1>
<p>We need a way to:</p>
<ul>
<li>Add a new dead zombie</li>
<li>Store our dead zombies</li>
<li>Show dead zombie details (in a <code>&lt;li&gt;</code> added to the <code>&lt;ul#zombielist&gt;</code>)</li>
<li>Reset zombies</li>
</ul>
</section>
<section class="level1" id="building-our-zombie-manager">
<h1>Building our Zombie Manager</h1>
<section class="level2" id="code-5">
<h2>Code</h2>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">window</span>.<span class="fu">zombieManager</span> = (<span class="kw">function</span>() {
  <span class="co">// An array to hold our dead zombies</span>
  <span class="kw">var</span> zombies       = <span class="kw">new</span> <span class="kw">Array</span>();
  <span class="co">// Each killing method has a corresponding icon. Here we map them.</span>
  <span class="kw">var</span> zombie_icons  = {
    <span class="ch">&#39;nukes&#39;</span>         : <span class="ch">&#39;z2.png&#39;</span>,
    <span class="ch">&#39;conflagration&#39;</span> : <span class="ch">&#39;z5.png&#39;</span>,
    <span class="ch">&#39;tank&#39;</span>          : <span class="ch">&#39;z7.png&#39;</span>,
    <span class="ch">&#39;trickery&#39;</span>      : <span class="ch">&#39;z11.png&#39;</span>,
    <span class="ch">&#39;poison&#39;</span>        : <span class="ch">&#39;z13.png&#39;</span>,
    <span class="ch">&#39;corrosive&#39;</span>     : <span class="ch">&#39;z8.png&#39;</span>,
    <span class="ch">&#39;dismemberment&#39;</span> : <span class="ch">&#39;z14.png&#39;</span>
  };
  <span class="co">// Wipe out the zombies and start over</span>
  <span class="kw">var</span> resetZombies = <span class="kw">function</span>() { };

  <span class="co">// Refresh/show &lt;ul&gt; of zombies nabbed</span>
  <span class="kw">var</span> showZombies = <span class="kw">function</span>() { };

  <span class="co">// Return object literal</span>
  <span class="kw">return</span> {
    <span class="co">// Add a new zombie to the list of zombies</span>
    <span class="dt">addZombie     </span>: <span class="kw">function</span>(zombieWhen, zombieWhere, zombieHow) { }
  }
}());</code></pre>
</section>
</section>
<section class="level1" id="a-few-deets">
<h1>A few deets</h1>
<ul>
<li><p>The <code>zombieManager</code> function invokes itself:</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">window</span>.<span class="fu">zombieManager</span> = (<span class="kw">function</span>() {
  <span class="co">// ...</span>
}());</code></pre></li>
<li><p><code>zombieManager.addZombie</code> is now available:</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">return</span> {
    <span class="co">// Add a new zombie to the list of zombies</span>
    <span class="dt">addZombie     </span>: <span class="kw">function</span>(zombieWhen, zombieWhere, zombieHow) { }
  }</code></pre></li>
<li><p>So, the <code>window.zombieManager</code> object is available to us, and has a single available method, <code>addZombie</code>.</p></li>
</ul>
</section>
<section class="level1" id="adding-a-dead-zombie">
<h1>Adding a Dead Zombie</h1>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">return</span> {
  <span class="co">// Add a new zombie to the list of zombies</span>
  <span class="dt">addZombie     </span>: <span class="kw">function</span>(zombieWhen, zombieWhere, zombieHow) {
    <span class="co">// Add a new object to the zombies array</span>
    zombies[<span class="kw">zombies</span>.<span class="fu">length</span>] = {
      <span class="dt">when      </span>: <span class="kw">zombieWhen</span>.<span class="fu">valueOf</span>(),
      <span class="dt">where     </span>: zombieWhere,
      <span class="dt">how       </span>: zombieHow
    };
    showZombies();
  }
}</code></pre>
<p>Let's go look at <code>showZombies</code>...</p>
</section>
<section class="level1" id="showing-the-dead-zombies">
<h1>Showing the dead Zombies</h1>
<section class="level2" id="code-6">
<h2>Code</h2>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Refresh/show &lt;ul&gt; of zombies nabbed</span>
<span class="kw">var</span> showZombies = <span class="kw">function</span>() {
  <span class="kw">for</span>(<span class="kw">var</span> i = <span class="dv">0</span>; i &lt; <span class="kw">zombies</span>.<span class="fu">length</span>; i++) {
    <span class="co">// Create and format an &lt;li&gt; element with each zombie&#39;s details</span>
    <span class="co">// More details in just a sec...</span>
  }
  <span class="kw">if</span> (zombies &amp;&amp; <span class="kw">zombies</span>.<span class="fu">length</span> &amp;&amp; !$(<span class="ch">&#39;#zombie-reset&#39;</span>).<span class="fu">length</span>) {
    $startOver = $(<span class="ch">&#39;&lt;button&gt;Reset my Zombies&lt;/button&gt;&#39;</span>).<span class="fu">attr</span>(<span class="ch">&#39;id&#39;</span>, <span class="ch">&#39;zombie-reset&#39;</span>);
    $(<span class="ch">&#39;#zombielist&#39;</span>).<span class="fu">after</span>($startOver);
    <span class="co">// Assign click handler to reset the zombie list</span>
    $(<span class="ch">&#39;#zombie-reset&#39;</span>).<span class="fu">button</span>().<span class="fu">click</span>(<span class="kw">function</span>() {
      resetZombies();
    });
  }
  <span class="co">// Refresh the listview for #zombielist because we&#39;ve (likely)</span>
  <span class="co">// altered the list.</span>
  $(<span class="ch">&#39;#zombielist&#39;</span>).<span class="fu">listview</span>(<span class="ch">&#39;refresh&#39;</span>);
};</code></pre>
<ul>
<li>Have to refresh the listview (for the <code>&lt;ul#zombielist&gt;</code>) after altering elements in the list.</li>
</ul>
</section>
</section>
<section class="level1" id="building-a-row-for-the-dead-zombie">
<h1>Building a row for the dead zombie</h1>
<p>We're trying to emulate this markup:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;ul</span><span class="ot"> data-role=</span><span class="st">&quot;listview&quot;</span><span class="ot"> data-inset=</span><span class="st">&quot;true&quot;</span><span class="ot"> id=</span><span class="st">&quot;zombielist&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;li&gt;&lt;img</span><span class="ot"> src=</span><span class="st">&quot;icons/z2.png&quot;</span><span class="ot"> alt=</span><span class="st">&quot;Killed by micro-nukes&quot;</span> <span class="kw">/&gt;&lt;h3&gt;</span>Zombie Nabbed!<span class="kw">&lt;/h3&gt;</span>
  <span class="kw">&lt;p&gt;&lt;strong&gt;</span>01/18/12 13:44<span class="kw">&lt;/strong&gt;&lt;/p&gt;</span>
  <span class="kw">&lt;p&gt;</span>Coordinates: 40.7678494, -73.9853328<span class="kw">&lt;/p&gt;&lt;/li&gt;</span>
<span class="kw">&lt;/ul&gt;</span></code></pre>
</section>
<section class="level1" id="the-guts-of-showzombies">
<h1>The guts of showZombies</h1>
<section class="level2" id="code-7">
<h2>Code</h2>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">for</span>(<span class="kw">var</span> i = <span class="dv">0</span>; i &lt; <span class="kw">zombies</span>.<span class="fu">length</span>; i++) {
  <span class="kw">var</span> zombieWhen = <span class="kw">new</span> <span class="kw">Date</span>(zombies[i].<span class="fu">when</span>);
  <span class="kw">var</span> zombieID   = <span class="ch">&#39;zombie-&#39;</span> + <span class="kw">zombieWhen</span>.<span class="fu">format</span>(<span class="ch">&#39;mdyhis&#39;</span>);

  <span class="kw">if</span> (!$(<span class="st">&quot;#&quot;</span> + zombieID).<span class="fu">length</span>) { <span class="co">// If there isn&#39;t an &lt;li&gt; for this zombie</span>
    <span class="co">// Creating &lt;li class=&quot;zombie&quot; id=&quot;[zombieID]&quot;&gt;&lt;/li&gt;</span>
    <span class="kw">var</span> $zombieRow = $(<span class="ch">&#39;&lt;li&gt;&lt;/li&gt;&#39;</span>).<span class="fu">addClass</span>(<span class="ch">&#39;zombie&#39;</span>).<span class="fu">attr</span>(<span class="ch">&#39;id&#39;</span>, zombieID);
    <span class="co">// Creating the icon (&lt;img&gt; tag)</span>
    <span class="kw">if</span> (zombies[i].<span class="fu">how</span> &amp;&amp; zombie_icons[zombies[i].<span class="fu">how</span>]) {
      $zombieImg = $(<span class="st">&quot;&lt;img&gt;&quot;</span>).<span class="fu">attr</span>(
        { <span class="dt">src </span>:  <span class="ch">&#39;icons/&#39;</span> + zombie_icons[zombies[i].<span class="fu">how</span>],
          <span class="dt">alt </span>:  <span class="ch">&#39;How it died&#39;</span>
        });
      $<span class="kw">zombieRow</span>.<span class="fu">append</span>($zombieImg);
    }
    <span class="co">// Header and datetime info</span>
    $<span class="kw">zombieRow</span>.<span class="fu">append</span>( 
      <span class="ch">&#39;&lt;h3&gt;Zombie Nabbed!&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;&#39;</span>  + <span class="kw">zombieWhen</span>.<span class="fu">format</span>(<span class="ch">&#39;m/d/y H:i&#39;</span>)  + <span class="ch">&#39;&lt;/strong&gt;&lt;/p&gt;&#39;</span>
    );
    <span class="co">// If there is location information, add it to the &lt;li&gt;</span>
    <span class="kw">if</span> (zombies[i].<span class="fu">where</span> &amp;&amp; zombies[i].<span class="fu">where</span>.<span class="fu">coords</span>) {
      <span class="kw">var</span> coords = zombies[i].<span class="fu">where</span>.<span class="fu">coords</span>;
      $<span class="kw">zombieRow</span>.<span class="fu">append</span>(<span class="ch">&#39;&lt;p&gt;Coordinates: &#39;</span> 
      + <span class="kw">coords</span>.<span class="fu">latitude</span> + <span class="ch">&#39;, &#39;</span> 
      + <span class="kw">coords</span>.<span class="fu">longitude</span> + <span class="ch">&#39;&lt;/p&gt;&#39;</span>);
    }
    <span class="co">// Prepend the new &lt;li&gt; to the beginning of #zombielist</span>
    $(<span class="ch">&#39;#zombielist&#39;</span>).<span class="fu">prepend</span>($zombieRow);
  }
}</code></pre>
</section>
</section>
<section class="level1" id="resetting-zombies">
<h1>Resetting Zombies</h1>
<p>Now we can add zombies and show zombies. What if someone wants to start over and reset their zombies?</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Wipe out the zombies and start over</span>
<span class="kw">var</span> resetZombies = <span class="kw">function</span>() {
  zombies = <span class="kw">new</span> <span class="kw">Array</span>();
  $(<span class="ch">&#39;li.zombie&#39;</span>).<span class="fu">remove</span>();
  <span class="co">// We&#39;ve altered the listview by removing its elements...so...</span>
  $(<span class="ch">&#39;#zombielist&#39;</span>).<span class="fu">listview</span>(<span class="ch">&#39;refresh&#39;</span>);
};</code></pre>
</section>
<section class="level1" id="try-it-out-1">
<h1>Try it out!</h1>
<section class="level2" id="figure-i-got-one-on-an-android">
<h2>Figure: &quot;I got one!&quot; on an Android</h2>
<figure>
<img src="images/i-got-one-screenshots/android-list.png"><figcaption></figcaption>
</figure>
</section>
</section>
<section class="level1" id="cool-yeah-maybe-ok-but-kind-of-useless">
<h1>Cool, yeah, maybe, OK, but kind of useless</h1>
<ul>
<li>As soon as the page is reloaded, all of the zombies go away.</li>
<li>We need a way to store found zombies on the client.</li>
</ul>
<section class="level3" id="how-about-a-device-api">
<h3>How about a device API?</h3>
</section>
</section>
<section class="level1" id="localstorage">
<h1>localStorage</h1>
<figure>
<img src="images/06-storage.png"><figcaption></figcaption>
</figure>
<p>There is another standard device API for storing simple string key-value pairs on the client: <em>localStorage</em>.</p>
<section class="level3" id="however-we-need-to-store-more-than-strings...">
<h3>However, we need to store more than strings...</h3>
</section>
</section>
<section class="level1" id="leaning-on-our-brothers-again">
<h1>Leaning on our brothers again</h1>
<section class="level2" id="lawnchair">
<h2>Lawnchair</h2>
<figure>
<img src="images/06-lawnchair.png"><figcaption></figcaption>
</figure>
<ul>
<li>Lawnchair is an open source, simple JSON storage utility that can store data on the client.</li>
<li>Several adapters are available for Lawnchair, including one that uses localStorage underneath (DOM adapter).</li>
</ul>
</section>
</section>
<section class="level1" id="lets-kick-up-a-lawnchair-yeah">
<h1>Let's kick up a Lawnchair, yeah?</h1>
<p>Instantiate the Lawnchair. Do this right after initializing the <code>zombies</code> array in the <code>zombieManager</code> function.</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">window</span>.<span class="fu">zombieManager</span> = (<span class="kw">function</span>() {
  <span class="kw">var</span> zombies       = <span class="kw">new</span> <span class="kw">Array</span>();
  <span class="kw">var</span> zombieChair   = Lawnchair({<span class="dt">name</span>: <span class="ch">&#39;zombies&#39;</span>}, <span class="kw">function</span>() {});</code></pre>
</section>
<section class="level1" id="add-an-init-function">
<h1>Add an init function</h1>
<p>We'll need a way for to call an initialization function when the page is ready, to get those dead zombies out of ice storage, into the <code>zombies</code> array and displayed:</p>
<section class="level2" id="code-8">
<h2>Code</h2>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">return</span> {
  <span class="co">// Init; build initial #zombielist</span>
  <span class="dt">init          </span>: <span class="kw">function</span>() {
    <span class="kw">zombieChair</span>.<span class="fu">get</span>(<span class="ch">&#39;zombies&#39;</span>, <span class="kw">function</span>(zombiesOnIce) {
      <span class="kw">if</span> (zombiesOnIce) {
        <span class="co">// If there are zombies stored, populate the </span>
        <span class="co">// zombies array with those zombies</span>
        zombies = <span class="kw">zombiesOnIce</span>.<span class="fu">value</span>;
      }
    });
    <span class="co">// Now, show the zombies</span>
    showZombies();
  },
  <span class="co">// Add a new zombie to the list of zombies</span>
  <span class="dt">addZombie     </span>: <span class="kw">function</span>(zombieWhen, zombieWhere, zombieHow) {
  <span class="co">// ...</span></code></pre>
</section>
</section>
<section class="level1" id="update-the-addzombie-function...">
<h1>...update the addZombie function...</h1>
<p>We need to store the zombie in the Lawnchair as well as the ephemeral array.</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript">  },
  <span class="co">// Add a new zombie to the list of zombies</span>
  <span class="dt">addZombie     </span>: <span class="kw">function</span>(zombieWhen, zombieWhere, zombieHow) {
    zombies[<span class="kw">zombies</span>.<span class="fu">length</span>] = {
      <span class="dt">when      </span>: <span class="kw">zombieWhen</span>.<span class="fu">valueOf</span>(),
      <span class="dt">where     </span>: zombieWhere,
      <span class="dt">how       </span>: zombieHow
    };
    <span class="kw">zombieChair</span>.<span class="fu">save</span>({<span class="dt">key</span>: <span class="ch">&#39;zombies&#39;</span>, <span class="dt">value </span>: zombies });
    showZombies();
  }</code></pre>
</section>
<section class="level1" id="update-the-resetzombies-function...">
<h1>...update the resetZombies function...</h1>
<p>Nuke the contents of the Lawnchair as well as the array.</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> resetZombies = <span class="kw">function</span>() {
    zombies = <span class="kw">new</span> <span class="kw">Array</span>();
    <span class="kw">zombieChair</span>.<span class="fu">nuke</span>();
    $(<span class="ch">&#39;li.zombie&#39;</span>).<span class="fu">remove</span>();
    $(<span class="ch">&#39;#zombielist&#39;</span>).<span class="fu">listview</span>(<span class="ch">&#39;refresh&#39;</span>);
  };</code></pre>
</section>
<section class="level1" id="and-add-a-call-to-the-init-function...">
<h1>And add a call to the init function...</h1>
<section class="level3" id="and-finally">
<h3>And finally</h3>
<p>When the jQM page and its widgets are ready to go, call that <code>init</code> function:</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript">$(<span class="st">&quot;#nab-zombie&quot;</span>).<span class="fu">live</span>(<span class="ch">&#39;pageinit&#39;</span>, <span class="kw">function</span>() {
  <span class="co">// Initialize our list of zombies</span>
  <span class="kw">zombieManager</span>.<span class="fu">init</span>();
  <span class="co">// Is Geolocation supported?</span>
  <span class="co">// ...</span></code></pre>
</section>
</section>
<section class="level1" id="take-it-for-a-spin">
<h1>Take it for a spin</h1>
<section class="level2" id="figure-screen-shot-of-i-got-one">
<h2>Figure: Screen shot of I Got One!</h2>
<figure>
<img src="images/06-screen.png"><figcaption></figcaption>
</figure>
</section>
</section>
<section class="level1" id="as-always-there-are-gotchas">
<h1>As always, there are gotchas</h1>
<ul>
<li>Date objects don't unserialize correctly from Lawnchair (so we are storing a string representation of a Date object).</li>
<li>jQM <code>pagecreate</code> and <code>pageinit</code> events can be a bit tricky.</li>
</ul>
</section>
<section class="level1" id="getting-the-final-mile">
<h1>Getting the final mile</h1>
<p>Sometimes the zombies you face are not vulnerable to the mad skills you possess. Some things just aren't yet attainable on the mobile web, which is why <a href="07-desperate-times.html">desperate times call for desperate measures</a>.</p>
</section>
</body>
</html>
