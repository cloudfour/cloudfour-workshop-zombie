<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Frameworks (jQuery Mobile) and localStorage" />
  <title>A Band of Brothers</title>
  <style type="text/css">
/*<![CDATA[*/
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode, table.sourceCode pre 
   { margin: 0; padding: 0; border: 0; vertical-align: baseline; border: none; }
td.lineNumbers { border-right: 1px solid #AAAAAA; text-align: right; color: #AAAAAA; padding-right: 5px; padding-left: 5px; }
td.sourceCode { padding-left: 5px; }
code.sourceCode span.kw { color: #007020; font-weight: bold; } 
code.sourceCode span.dt { color: #902000; }
code.sourceCode span.dv { color: #40a070; }
code.sourceCode span.bn { color: #40a070; }
code.sourceCode span.fl { color: #40a070; }
code.sourceCode span.ch { color: #4070a0; }
code.sourceCode span.st { color: #4070a0; }
code.sourceCode span.co { color: #60a0b0; font-style: italic; }
code.sourceCode span.ot { color: #007020; }
code.sourceCode span.al { color: red; font-weight: bold; }
code.sourceCode span.fu { color: #06287e; }
code.sourceCode span.re { }
code.sourceCode span.er { color: red; font-weight: bold; }
/*]]>*/
  </style>
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
    href="http://www.w3.org/Talks/Tools/Slidy2/styles/slidy.css" />
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
   href="../assets/styles/workshop.css" />
  <script src="http://www.w3.org/Talks/Tools/Slidy2/scripts/slidy.js.gz"
    charset="utf-8" type="text/javascript"></script>
</head>
<body>
<div class="slide titlepage">
  <h1 class="title">A Band of Brothers</h1>
  <p class="author">
Frameworks (jQuery Mobile) and localStorage
  </p>
</div>
<div id="i-got-one" class="slide">
<h1>I got one!</h1>
<div class="figure">
<img src="images/06-3ws.png" /><p class="caption"></p>
</div>
<p>Sigma Stronghold leaders want a way for agents in the field to be able to record their zombie kills.</p>
<p>Each time a soldier nabs a zombie out there, he or she should be able to record when, where and how that zombie met its fate. Kind of like a zombie kill board.</p>
</div>
<div id="frameworks" class="slide">
<h1>Frameworks</h1>
<div id="so-how-do-we-build-something-like-this">
<h2>So, how do we build something like this?</h2>
<p>Sometimes you don't want to keep re-inventing the same zombie-blasting cannon over and over again. We zombie fighters might be a ragtag bunch, but we stick together.</p>
<p>Frameworks, libraries, tools, templates...all of these can give you a leg up.</p>
</div>
</div>
<div id="jquery-mobile" class="slide">
<h1>jQuery Mobile</h1>
<div class="figure">
<img src="images/06-jquerymobile-com.png" /><p class="caption"></p>
</div>
<p>jQuery Mobile is a mobile web framework built atop the popular jQuery library.</p>
<p>jQuery Mobile works hand-in-hand with semantic HTML5 markup.</p>
</div>
<div id="building-with-jquery-mobile" class="slide">
<h1>Building with jQuery Mobile</h1>
<p>Content and applications with jQuery Mobile are constructed from:</p>
<ul>
<li>Rather basic HTML5 markup.</li>
<li>The inclusion of the jQuery core JavaScript library, the jQuery Mobile JS and the jQuery Mobile CSS.</li>
<li>You can build on this with your own JavaScript, as you please.</li>
</ul>
</div>
<div id="structure-of-jquery-mobile-page" class="slide">
<h1>Structure of jQuery Mobile Page</h1>
<div id="code">
<h2>Code</h2>
<pre class="sourceCode"><code class="sourceCode html"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span> <br /><span class="kw">&lt;html&gt;</span> <br />    <span class="kw">&lt;head&gt;</span> <br />    <span class="kw">&lt;title&gt;</span>I Got One!<span class="kw">&lt;/title&gt;</span> <br />    <span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">&quot;viewport&quot;</span><span class="ot"> content=</span><span class="st">&quot;width=device-width, initial-scale=1, maximum-scale=1&quot;</span><span class="kw">&gt;</span><br />    <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href=</span><span class="st">&quot;http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.css&quot;</span> <span class="kw">/&gt;</span><br />    <span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="ot"> src=</span><span class="st">&quot;http://code.jquery.com/jquery-1.6.4.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span><br />    <span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="ot"> src=</span><span class="st">&quot;http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span><br /><span class="kw">&lt;/head&gt;</span><br /><span class="kw">&lt;body&gt;</span> <br /><br /><span class="kw">&lt;div</span><span class="ot"> data-role=</span><span class="st">&quot;page&quot;</span><span class="kw">&gt;</span><br />  <span class="kw">&lt;div</span><span class="ot"> data-role=</span><span class="st">&quot;header&quot;</span><span class="kw">&gt;</span><br />  <span class="kw">&lt;/div&gt;</span><br /><br />  <span class="kw">&lt;div</span><span class="ot"> data-role=</span><span class="st">&quot;content&quot;</span><span class="kw">&gt;</span><br />  <span class="kw">&lt;/div&gt;</span><br /><span class="kw">&lt;/div&gt;</span><br /><br /><span class="kw">&lt;/body&gt;</span><br /><span class="kw">&lt;/html&gt;</span></code></pre>
</div>
<div id="speaker-notes">
<h2>Speaker Notes</h2>
<ul>
<li>Note the maximum-scale zoom thing here</li>
</ul>
</div>
</div>
<div id="jquery-mobile-page-structure" class="slide">
<h1>jQuery Mobile Page Structure</h1>
<div class="figure">
<img src="images/06-jqm.png" /><p class="caption"></p>
</div>
<ul>
<li>Delineated by HTML5 <code>data-</code> attributes.</li>
<li>Enables content loading via AJAX.</li>
</ul>
<pre class="sourceCode"><code class="sourceCode html"><span class="kw">&lt;div</span><span class="ot"> data-role=</span><span class="st">&quot;page&quot;</span><span class="kw">&gt;</span><br />  <span class="kw">&lt;div</span><span class="ot"> data-role=</span><span class="st">&quot;header&quot;</span><span class="kw">&gt;&lt;/div&gt;</span><br />  <span class="kw">&lt;div</span><span class="ot"> data-role=</span><span class="st">&quot;content&quot;</span><span class="kw">&gt;&lt;/div&gt;</span><br />  <span class="kw">&lt;div</span><span class="ot"> data-role=</span><span class="st">&quot;footer&quot;</span><span class="kw">&gt;&lt;/div&gt;</span><br /><span class="kw">&lt;/div&gt;</span></code></pre>
</div>
<div id="relying-on-our-bros" class="slide">
<h1>Relying on our bros</h1>
<div id="code-1">
<h2>Code</h2>
<pre class="sourceCode"><code class="sourceCode html"><span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">&quot;viewport&quot;</span><span class="ot"> content=</span><span class="st">&quot;width=device-width, initial-scale=1, maximum-scale=1&quot;</span><span class="kw">&gt;</span><br /><span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href=</span><span class="st">&quot;http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.css&quot;</span> <span class="kw">/&gt;</span><br /><span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="ot"> src=</span><span class="st">&quot;http://code.jquery.com/jquery-1.6.4.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span><br /><span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="ot"> src=</span><span class="st">&quot;http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span><br /><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;date.format.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span><br /><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;http://code.google.com/apis/gears/gears_init.js&quot;</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="kw">&gt;&lt;/script&gt;</span><br /><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;geo.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span><br /><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;zombie.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></code></pre>
<ul>
<li><code>date.format.js</code> (Date.format) lets us do much easier date formatting with JavaScript.</li>
<li>Using Google Gears and the <code>geo-location-js</code> library makes cross-platform geolocation a snap.</li>
</ul>
</div>
</div>
<div id="ok-lets-go" class="slide">
<h1>OK, let's go!</h1>
<p>Find the starting point for the &quot;I got one!&quot; web app in your rucksack, in the <code>i-got-one</code> folder. Go ahead and open <code>index.html</code> in your text editor.</p>
<div id="our-mission">
<h3>Our mission</h3>
<p>The starting point is an empty jQuery Mobile page. We'll need to:</p>
<ol style="list-style-type: decimal">
<li>Add a header to see how jQM automatically styles stuff for us.</li>
<li>Drop in some user interface elements so soldiers can enter their nabbed zombies.</li>
<li>Add some custom JavaScript</li>
</ol>
</div>
</div>
<div id="add-a-header" class="slide">
<h1>Add a header</h1>
<p>At the outset, our jQM page is empty. Let's put some stuff in it.</p>
<ul>
<li>This is in the <code>&lt;div data-role=&quot;header&quot;&gt;</code>.</li>
<li>jQuery Mobile's CSS and JS will stye this into a (rather iOS-esque) header element.</li>
</ul>
<pre class="sourceCode"><code class="sourceCode html"><span class="kw">&lt;div</span><span class="ot"> data-role=</span><span class="st">&quot;header&quot;</span><span class="kw">&gt;</span><br />  <span class="kw">&lt;h1&gt;</span>I got one!<span class="kw">&lt;/h1&gt;</span><br /><span class="kw">&lt;/div&gt;</span></code></pre>
<div id="index.html">
<h5>index.html</h5>
</div>
<div id="try-it-out">
<h3>Try it out!</h3>
</div>
</div>
<div id="et-voila" class="slide">
<h1>Et Voila!</h1>
<div id="figure-a-header-in-jqm">
<h2>Figure: A header in jQM</h2>
<div class="figure">
<img src="images/06-header.png" /><p class="caption"></p>
</div>
</div>
</div>
<div id="putting-the-form-in" class="slide">
<h1>Putting the &quot;Form&quot; In</h1>
<div class="figure">
<img src="images/06-starting-point.png" /><p class="caption"></p>
</div>
<p>Easy, but not too exciting. Let's put in some UI elements that will let Sigma Stronghold fighters record a nabbed zombie.</p>
</div>
<div id="how-do-we-do-that" class="slide">
<h1>How do we do that?</h1>
<p>First, let's add a <code>&lt;select&gt;</code> element, just like you would do for any HTML form (except in our case, we don't have a containing form). Add this to the <code>&lt;div data-role=&quot;content&quot;&gt;</code> area.</p>
<div id="code-2">
<h2>Code</h2>
<pre class="sourceCode"><code class="sourceCode html"><span class="kw">&lt;div</span><span class="ot"> data-role=</span><span class="st">&quot;content&quot;</span><span class="kw">&gt;</span><br />  <span class="kw">&lt;div</span><span class="ot"> data-role=</span><span class="st">&quot;fieldcontain&quot;</span><span class="kw">&gt;</span><br />    <span class="kw">&lt;label</span><span class="ot"> for=</span><span class="st">&quot;how-zombie&quot;</span><span class="kw">&gt;</span>How'd you nab it?<span class="kw">&lt;/label&gt;</span><br />    <span class="kw">&lt;select</span><span class="ot"> name=</span><span class="st">&quot;how-zombie&quot;</span><span class="ot"> id=</span><span class="st">&quot;how-zombie&quot;</span><span class="kw">&gt;</span><br />      <span class="kw">&lt;option</span><span class="ot"> value=</span><span class="st">&quot;tank&quot;</span><span class="kw">&gt;</span>Tank<span class="kw">&lt;/option&gt;</span><br />      <span class="kw">&lt;option</span><span class="ot"> value=</span><span class="st">&quot;conflagration&quot;</span><span class="kw">&gt;</span>Conflagration<span class="kw">&lt;/option&gt;</span><br />      <span class="kw">&lt;option</span><span class="ot"> value=</span><span class="st">&quot;poison&quot;</span><span class="kw">&gt;</span>Poison<span class="kw">&lt;/option&gt;</span><br />      <span class="kw">&lt;option</span><span class="ot"> value=</span><span class="st">&quot;nukes&quot;</span><span class="kw">&gt;</span>Micro-nukes<span class="kw">&lt;/option&gt;</span><br />      <span class="kw">&lt;option</span><span class="ot"> value=</span><span class="st">&quot;trickery&quot;</span><span class="kw">&gt;</span>Trickery<span class="kw">&lt;/option&gt;</span><br />      <span class="kw">&lt;option</span><span class="ot"> value=</span><span class="st">&quot;corrosive&quot;</span><span class="kw">&gt;</span>Corrosive<span class="kw">&lt;/option&gt;</span><br />      <span class="kw">&lt;option</span><span class="ot"> value=</span><span class="st">&quot;dismemberment&quot;</span><span class="kw">&gt;</span>Dismemberment<span class="kw">&lt;/option&gt;</span><br />    <span class="kw">&lt;/select&gt;</span><br />  <span class="kw">&lt;/div&gt;</span> <br /><br /><span class="kw">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div id="now-well-add-a-button" class="slide">
<h1>Now, we'll add a button</h1>
<ul>
<li>Again, jQuery Mobile will create a styled, mobile-ish button from this <code>&lt;input&gt;</code> field.</li>
</ul>
<div id="code-3">
<h2>Code</h2>
<pre class="sourceCode"><code class="sourceCode html">      <span class="kw">&lt;option</span><span class="ot"> value=</span><span class="st">&quot;dismemberment&quot;</span><span class="kw">&gt;</span>Dismemberment<span class="kw">&lt;/option&gt;</span><br />    <span class="kw">&lt;/select&gt;</span><br />  <span class="kw">&lt;/div&gt;</span> <br />  <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;button&quot;</span><span class="ot"> value=</span><span class="st">&quot;I got one!&quot;</span><span class="ot"> id=</span><span class="st">&quot;got-one&quot;</span><span class="ot"> data-theme=</span><span class="st">&quot;b&quot;</span> <span class="kw">/&gt;</span><br /><span class="kw">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div id="dead-zombie-storage" class="slide">
<h1>Dead Zombie Storage</h1>
<p>When a soldier nabs a zombie by tapping the &quot;I Got One!&quot; button, we'll need a place to display the info about that poor zombie. For each zombie nabbed, we'll add a row to a <code>&lt;ul&gt;</code>. Let's create an empty <code>&lt;ul&gt;</code> to hold those incoming zombies. Put this at the very bottom of the <code>&lt;div data-role=&quot;content&quot;&gt;</code></p>
<pre class="sourceCode"><code class="sourceCode html"><span class="kw">&lt;/div&gt;</span> <br /><span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;button&quot;</span><span class="ot"> value=</span><span class="st">&quot;I got one!&quot;</span><span class="ot"> id=</span><span class="st">&quot;got-one&quot;</span><span class="ot"> data-theme=</span><span class="st">&quot;b&quot;</span> <span class="kw">/&gt;</span><br /><span class="kw">&lt;ul</span><span class="ot"> data-role=</span><span class="st">&quot;listview&quot;</span><span class="ot"> data-inset=</span><span class="st">&quot;true&quot;</span><span class="ot"> id=</span><span class="st">&quot;zombielist&quot;</span><span class="kw">&gt;</span><br /><span class="kw">&lt;/ul&gt;</span><br /><span class="kw">&lt;/div&gt;</span> <span class="co">&lt;!-- /End &lt;div data-role=&quot;content&quot;&gt; --&gt;</span></code></pre>
<p><code>data-role=&quot;listview&quot;</code> indicates to jQuery Mobile that this list should be styled as a list widget.</p>
</div>
<div id="a-list-widget-what-now" class="slide">
<h1>A list widget what now?</h1>
<div id="jquery-turns-this">
<h3>jQuery Turns This</h3>
<pre class="sourceCode"><code class="sourceCode html"><span class="kw">&lt;ul</span><span class="ot"> data-role=</span><span class="st">&quot;listview&quot;</span><span class="ot"> data-inset=</span><span class="st">&quot;true&quot;</span><span class="ot"> id=</span><span class="st">&quot;zombielist&quot;</span><span class="kw">&gt;</span><br />  <span class="kw">&lt;li&gt;&lt;img</span><span class="ot"> src=</span><span class="st">&quot;icons/z2.png&quot;</span><span class="ot"> alt=</span><span class="st">&quot;Killed by micro-nukes&quot;</span> <span class="kw">/&gt;&lt;h3&gt;</span>Zombie Nabbed!<span class="kw">&lt;/h3&gt;</span><br />  <span class="kw">&lt;p&gt;&lt;strong&gt;</span>01/18/12 13:44<span class="kw">&lt;/strong&gt;&lt;/p&gt;</span><br />  <span class="kw">&lt;p&gt;</span>Coordinates: 40.7678494, -73.9853328<span class="kw">&lt;/p&gt;&lt;/li&gt;</span><br /><span class="kw">&lt;/ul&gt;</span></code></pre>
</div>
<div id="into-this">
<h3>Into this</h3>
<div class="figure">
<img src="images/06-li-example.png" /><p class="caption"></p>
</div>
</div>
</div>
<div id="and-now-we-have-a-starting-point" class="slide">
<h1>And now we have a starting point</h1>
<div id="figure-screen-shot-of-our-current-page">
<h2>Figure: Screen shot of our current page</h2>
<div class="figure">
<img src="images/06-starting-point.png" /><p class="caption"></p>
</div>
</div>
</div>
<div id="a-quick-aside-about-browser-support" class="slide">
<h1>A quick aside about browser support</h1>
<div class="figure">
<img src="images/06-no-js.png" /><p class="caption"></p>
</div>
<ul>
<li>By its nature, jQuery Mobile practices enthusiastic progressive enhancement</li>
<li>jQuery Mobile works in browsers that do not support JavaScript</li>
<li>However, our functionality requirements for the &quot;I got one!&quot; app effectively require JavaScript</li>
</ul>
</div>
<div id="warning-javascript-ahead" class="slide">
<h1>Warning: JavaScript ahead</h1>
<div id="figure-alert">
<h2>Figure: ALERT!</h2>
<div class="figure">
<img src="images/06-alert.png" /><p class="caption"></p>
</div>
</div>
</div>
<div id="adding-the-javascript" class="slide">
<h1>Adding the JavaScript</h1>
<p>Now we can drop in some custom JavaScript that makes this go:</p>
<pre class="sourceCode"><code class="sourceCode html"><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;zombie.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></code></pre>
<p>The curious can open up <code>zombie.js</code> and follow along as I confuse you through the next several slides!</p>
</div>
<div id="working-with-jquery-mobile-events" class="slide">
<h1>Working with jQuery Mobile events</h1>
<ul>
<li>When the page is done loading and the widgets have been marked up...
<ul>
<li>Check for geolocation support</li>
<li>Add a click handler for the &quot;I Got One!&quot; button</li>
</ul></li>
</ul>
<pre class="sourceCode"><code class="sourceCode javascript">$(<span class="st">&quot;#nab-zombie&quot;</span>).<span class="fu">live</span>(<span class="ch">'pageinit'</span>, <span class="kw">function</span>() {<br />  <span class="co">// Is Geolocation supported?</span><br />  <span class="kw">var</span> geoHappy = <span class="kw">geo_position_js</span>.<span class="fu">init</span>();<br />  <span class="co">// Click handler for the &quot;Got One&quot; button</span><br />  $(<span class="st">&quot;#got-one&quot;</span>).<span class="fu">click</span>(<span class="kw">function</span>() {<br /><br />  });<br />});</code></pre>
</div>
<div id="more-about-that-click-handler" class="slide">
<h1>More about that click handler</h1>
<ul>
<li>Need to organize the info that will populate our zombie <code>&lt;li&gt;</code></li>
<li>Where, when and how...</li>
</ul>
<pre class="sourceCode"><code class="sourceCode javascript">$(<span class="st">&quot;#got-one&quot;</span>).<span class="fu">click</span>(<span class="kw">function</span>() {<br />  <span class="co">// A Date object (will default to right now)</span><br />  <span class="kw">var</span> now = <span class="kw">new</span> <span class="kw">Date</span>();<br />  <span class="co">// What's the value of the #how-zombie &lt;select&gt;?</span><br />  <span class="kw">var</span> how = $(<span class="st">&quot;#how-zombie&quot;</span>).<span class="fu">val</span>();<br />  <span class="kw">if</span> (geoHappy) { <span class="co">// Get position data if supported</span><br /><br />  } <span class="kw">else</span> { <span class="co">// It's also OK to add a zombie w/o location data</span><br /><br />  }<br />});</code></pre>
</div>
<div id="fleshing-it-out..." class="slide">
<h1>Fleshing it out...</h1>
<pre class="sourceCode"><code class="sourceCode javascript"><span class="kw">if</span> (geoHappy) {<br />  <span class="co">// Get the current position (just like with W3C API)</span><br />  <span class="kw">geo_position_js</span>.<span class="fu">getCurrentPosition</span>(<span class="kw">function</span>(position) {<br />    <span class="kw">zombieManager</span>.<span class="fu">addZombie</span>(now, position, how);<br />  }, <span class="kw">function</span>(error) {<br />    <span class="kw">console</span>.<span class="fu">log</span>(<span class="st">&quot;Geolocation error: &quot;</span> + <span class="kw">error</span>.<span class="fu">message</span>);<br />    <span class="kw">zombieManager</span>.<span class="fu">addZombie</span>(now, null, how);<br />  });<br />} <span class="kw">else</span> { <span class="co">// It's also OK to add a zombie w/o location data</span><br />  <span class="kw">zombieManager</span>.<span class="fu">addZombie</span>(now, null, how);<br />}</code></pre>
<p>We'll talk about <code>zombieManager</code> in just a moment.</p>
</div>
<div id="all-together-now" class="slide">
<h1>All together now</h1>
<div id="code-4">
<h2>Code</h2>
<pre class="sourceCode"><code class="sourceCode javascript">$(<span class="st">&quot;#nab-zombie&quot;</span>).<span class="fu">live</span>(<span class="ch">'pageinit'</span>, <span class="kw">function</span>() {<br />  <span class="co">// Is Geolocation supported?</span><br />  <span class="kw">var</span> geoHappy = <span class="kw">geo_position_js</span>.<span class="fu">init</span>();<br />  <span class="co">// Click handler for the &quot;Got One&quot; button</span><br />  $(<span class="st">&quot;#got-one&quot;</span>).<span class="fu">click</span>(<span class="kw">function</span>() {<br />    <span class="kw">var</span> now = <span class="kw">new</span> <span class="kw">Date</span>();<br />    <span class="kw">var</span> how = $(<span class="st">&quot;#how-zombie&quot;</span>).<span class="fu">val</span>();<br />    <span class="co">// Get position data if supported</span><br />    <span class="kw">if</span> (geoHappy) {<br />      <span class="kw">geo_position_js</span>.<span class="fu">getCurrentPosition</span>(<span class="kw">function</span>(position) {<br />        <span class="kw">zombieManager</span>.<span class="fu">addZombie</span>(now, position, how);<br />      }, <span class="kw">function</span>(error) {<br />        <span class="kw">console</span>.<span class="fu">log</span>(<span class="st">&quot;Geolocation error: &quot;</span> + <span class="kw">error</span>.<span class="fu">message</span>);<br />        <span class="kw">zombieManager</span>.<span class="fu">addZombie</span>(now, null, how);<br />      });<br />    } <span class="kw">else</span> { <span class="co">// It's also OK to add a zombie w/o location data</span><br />      <span class="kw">zombieManager</span>.<span class="fu">addZombie</span>(now, null, how);<br />    }<br />  });<br />});</code></pre>
</div>
</div>
<div id="managing-our-zombies" class="slide">
<h1>Managing our Zombies</h1>
<p>We need a way to:</p>
<ul>
<li>Add a new dead zombie</li>
<li>Store our dead zombies</li>
<li>Show dead zombie details (in a <code>&lt;li&gt;</code> added to the <code>&lt;ul#zombielist&gt;</code>)</li>
<li>Reset zombies</li>
</ul>
</div>
<div id="building-our-zombie-manager" class="slide">
<h1>Building our Zombie Manager</h1>
<div id="code-5">
<h2>Code</h2>
<pre class="sourceCode"><code class="sourceCode javascript"><span class="kw">window</span>.<span class="fu">zombieManager</span> = (<span class="kw">function</span>() {<br />  <span class="co">// An array to hold our dead zombies</span><br />  <span class="kw">var</span> zombies       = <span class="kw">new</span> <span class="kw">Array</span>();<br />  <span class="co">// Each killing method has a corresponding icon. Here we map them.</span><br />  <span class="kw">var</span> zombie_icons  = {<br />    <span class="ch">'nukes'</span>         : <span class="ch">'z2.png'</span>,<br />    <span class="ch">'conflagration'</span> : <span class="ch">'z5.png'</span>,<br />    <span class="ch">'tank'</span>          : <span class="ch">'z7.png'</span>,<br />    <span class="ch">'trickery'</span>      : <span class="ch">'z11.png'</span>,<br />    <span class="ch">'poison'</span>        : <span class="ch">'z13.png'</span>,<br />    <span class="ch">'corrosive'</span>     : <span class="ch">'z8.png'</span>,<br />    <span class="ch">'dismemberment'</span> : <span class="ch">'z14.png'</span><br />  };<br />  <span class="co">// Wipe out the zombies and start over</span><br />  <span class="kw">var</span> resetZombies = <span class="kw">function</span>() { };<br /><br />  <span class="co">// Refresh/show &lt;ul&gt; of zombies nabbed</span><br />  <span class="kw">var</span> showZombies = <span class="kw">function</span>() { };<br /><br />  <span class="co">// Return object literal</span><br />  <span class="kw">return</span> {<br />    <span class="co">// Add a new zombie to the list of zombies</span><br />    <span class="dt">addZombie     </span>: <span class="kw">function</span>(zombieWhen, zombieWhere, zombieHow) { }<br />  }<br />}());</code></pre>
</div>
</div>
<div id="a-few-deets" class="slide">
<h1>A few deets</h1>
<ul>
<li><p>The <code>zombieManager</code> function invokes itself:</p>
<pre class="sourceCode"><code class="sourceCode javascript"><span class="kw">window</span>.<span class="fu">zombieManager</span> = (<span class="kw">function</span>() {<br />  <span class="co">// ...</span><br />}());</code></pre></li>
<li><p><code>zombieManager.addZombie</code> is now available:</p>
<pre class="sourceCode"><code class="sourceCode javascript"><span class="kw">return</span> {<br />    <span class="co">// Add a new zombie to the list of zombies</span><br />    <span class="dt">addZombie     </span>: <span class="kw">function</span>(zombieWhen, zombieWhere, zombieHow) { }<br />  }</code></pre></li>
<li><p>So, the <code>window.zombieManager</code> object is available to us, and has a single available method, <code>addZombie</code>.</p></li>
</ul>
</div>
<div id="adding-a-dead-zombie" class="slide">
<h1>Adding a Dead Zombie</h1>
<pre class="sourceCode"><code class="sourceCode javascript"><span class="kw">return</span> {<br />  <span class="co">// Add a new zombie to the list of zombies</span><br />  <span class="dt">addZombie     </span>: <span class="kw">function</span>(zombieWhen, zombieWhere, zombieHow) {<br />    <span class="co">// Add a new object to the zombies array</span><br />    zombies[<span class="kw">zombies</span>.<span class="fu">length</span>] = {<br />      <span class="dt">when      </span>: <span class="kw">zombieWhen</span>.<span class="fu">valueOf</span>(),<br />      <span class="dt">where     </span>: zombieWhere,<br />      <span class="dt">how       </span>: zombieHow<br />    };<br />    showZombies();<br />  }<br />}</code></pre>
<p>Let's go look at <code>showZombies</code>...</p>
</div>
<div id="showing-the-dead-zombies" class="slide">
<h1>Showing the dead Zombies</h1>
<div id="code-6">
<h2>Code</h2>
<pre class="sourceCode"><code class="sourceCode javascript"><span class="co">// Refresh/show &lt;ul&gt; of zombies nabbed</span><br /><span class="kw">var</span> showZombies = <span class="kw">function</span>() {<br />  <span class="kw">for</span>(<span class="kw">var</span> i = <span class="dv">0</span>; i &lt; <span class="kw">zombies</span>.<span class="fu">length</span>; i++) {<br />    <span class="co">// Create and format an &lt;li&gt; element with each zombie's details</span><br />    <span class="co">// More details in just a sec...</span><br />  }<br />  <span class="kw">if</span> (zombies &amp;&amp; <span class="kw">zombies</span>.<span class="fu">length</span> &amp;&amp; !$(<span class="ch">'#zombie-reset'</span>).<span class="fu">length</span>) {<br />    $startOver = $(<span class="ch">'&lt;button&gt;Reset my Zombies&lt;/button&gt;'</span>).<span class="fu">attr</span>(<span class="ch">'id'</span>, <span class="ch">'zombie-reset'</span>);<br />    $(<span class="ch">'#zombielist'</span>).<span class="fu">after</span>($startOver);<br />    <span class="co">// Assign click handler to reset the zombie list</span><br />    $(<span class="ch">'#zombie-reset'</span>).<span class="fu">button</span>().<span class="fu">click</span>(<span class="kw">function</span>() {<br />      resetZombies();<br />    });<br />  }<br />  <span class="co">// Refresh the listview for #zombielist because we've (likely)</span><br />  <span class="co">// altered the list.</span><br />  $(<span class="ch">'#zombielist'</span>).<span class="fu">listview</span>(<span class="ch">'refresh'</span>);<br />};</code></pre>
<ul>
<li>Have to refresh the listview (for the <code>&lt;ul#zombielist&gt;</code>) after altering elements in the list.</li>
</ul>
</div>
</div>
<div id="building-a-row-for-the-dead-zombie" class="slide">
<h1>Building a row for the dead zombie</h1>
<p>We're trying to emulate this markup:</p>
<pre class="sourceCode"><code class="sourceCode html"><span class="kw">&lt;ul</span><span class="ot"> data-role=</span><span class="st">&quot;listview&quot;</span><span class="ot"> data-inset=</span><span class="st">&quot;true&quot;</span><span class="ot"> id=</span><span class="st">&quot;zombielist&quot;</span><span class="kw">&gt;</span><br />  <span class="kw">&lt;li&gt;&lt;img</span><span class="ot"> src=</span><span class="st">&quot;icons/z2.png&quot;</span><span class="ot"> alt=</span><span class="st">&quot;Killed by micro-nukes&quot;</span> <span class="kw">/&gt;&lt;h3&gt;</span>Zombie Nabbed!<span class="kw">&lt;/h3&gt;</span><br />  <span class="kw">&lt;p&gt;&lt;strong&gt;</span>01/18/12 13:44<span class="kw">&lt;/strong&gt;&lt;/p&gt;</span><br />  <span class="kw">&lt;p&gt;</span>Coordinates: 40.7678494, -73.9853328<span class="kw">&lt;/p&gt;&lt;/li&gt;</span><br /><span class="kw">&lt;/ul&gt;</span></code></pre>
</div>
<div id="the-guts-of-showzombies" class="slide">
<h1>The guts of showZombies</h1>
<div id="code-7">
<h2>Code</h2>
<pre class="sourceCode"><code class="sourceCode javascript"><span class="kw">for</span>(<span class="kw">var</span> i = <span class="dv">0</span>; i &lt; <span class="kw">zombies</span>.<span class="fu">length</span>; i++) {<br />  <span class="kw">var</span> zombieWhen = <span class="kw">new</span> <span class="kw">Date</span>(zombies[i].<span class="fu">when</span>);<br />  <span class="kw">var</span> zombieID   = <span class="ch">'zombie-'</span> + <span class="kw">zombieWhen</span>.<span class="fu">format</span>(<span class="ch">'mdyhis'</span>);<br /><br />  <span class="kw">if</span> (!$(<span class="st">&quot;#&quot;</span> + zombieID).<span class="fu">length</span>) { <span class="co">// If there isn't an &lt;li&gt; for this zombie</span><br />    <span class="co">// Creating &lt;li class=&quot;zombie&quot; id=&quot;[zombieID]&quot;&gt;&lt;/li&gt;</span><br />    <span class="kw">var</span> $zombieRow = $(<span class="ch">'&lt;li&gt;&lt;/li&gt;'</span>).<span class="fu">addClass</span>(<span class="ch">'zombie'</span>).<span class="fu">attr</span>(<span class="ch">'id'</span>, zombieID);<br />    <span class="co">// Creating the icon (&lt;img&gt; tag)</span><br />    <span class="kw">if</span> (zombies[i].<span class="fu">how</span> &amp;&amp; zombie_icons[zombies[i].<span class="fu">how</span>]) {<br />      $zombieImg = $(<span class="st">&quot;&lt;img&gt;&quot;</span>).<span class="fu">attr</span>(<br />        { <span class="dt">src </span>:  <span class="ch">'icons/'</span> + zombie_icons[zombies[i].<span class="fu">how</span>],<br />          <span class="dt">alt </span>:  <span class="ch">'How it died'</span><br />        });<br />      $<span class="kw">zombieRow</span>.<span class="fu">append</span>($zombieImg);<br />    }<br />    <span class="co">// Header and datetime info</span><br />    $<span class="kw">zombieRow</span>.<span class="fu">append</span>( <br />      <span class="ch">'&lt;h3&gt;Zombie Nabbed!&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;'</span>  + <span class="kw">zombieWhen</span>.<span class="fu">format</span>(<span class="ch">'m/d/y H:i'</span>)  + <span class="ch">'&lt;/strong&gt;&lt;/p&gt;'</span><br />    );<br />    <span class="co">// If there is location information, add it to the &lt;li&gt;</span><br />    <span class="kw">if</span> (zombies[i].<span class="fu">where</span> &amp;&amp; zombies[i].<span class="fu">where</span>.<span class="fu">coords</span>) {<br />      <span class="kw">var</span> coords = zombies[i].<span class="fu">where</span>.<span class="fu">coords</span>;<br />      $<span class="kw">zombieRow</span>.<span class="fu">append</span>(<span class="ch">'&lt;p&gt;Coordinates: '</span> <br />      + <span class="kw">coords</span>.<span class="fu">latitude</span> + <span class="ch">', '</span> <br />      + <span class="kw">coords</span>.<span class="fu">longitude</span> + <span class="ch">'&lt;/p&gt;'</span>);<br />    }<br />    <span class="co">// Prepend the new &lt;li&gt; to the beginning of #zombielist</span><br />    $(<span class="ch">'#zombielist'</span>).<span class="fu">prepend</span>($zombieRow);<br />  }<br />}</code></pre>
</div>
</div>
<div id="resetting-zombies" class="slide">
<h1>Resetting Zombies</h1>
<p>Now we can add zombies and show zombies. What if someone wants to start over and reset their zombies?</p>
<pre class="sourceCode"><code class="sourceCode javascript"><span class="co">// Wipe out the zombies and start over</span><br /><span class="kw">var</span> resetZombies = <span class="kw">function</span>() {<br />  zombies = <span class="kw">new</span> <span class="kw">Array</span>();<br />  $(<span class="ch">'li.zombie'</span>).<span class="fu">remove</span>();<br />  <span class="co">// We've altered the listview by removing its elements...so...</span><br />  $(<span class="ch">'#zombielist'</span>).<span class="fu">listview</span>(<span class="ch">'refresh'</span>);<br />};</code></pre>
</div>
<div id="try-it-out-1" class="slide">
<h1>Try it out!</h1>
<div id="figure-i-got-one-on-an-android">
<h2>Figure: &quot;I got one!&quot; on an Android</h2>
<div class="figure">
<img src="images/i-got-one-screenshots/android-list.png" /><p class="caption"></p>
</div>
</div>
</div>
<div id="cool-yeah-maybe-ok-but-kind-of-useless" class="slide">
<h1>Cool, yeah, maybe, OK, but kind of useless</h1>
<ul>
<li>As soon as the page is reloaded, all of the zombies go away.</li>
<li>We need a way to store found zombies on the client.</li>
</ul>
<div id="how-about-a-device-api">
<h3>How about a device API?</h3>
</div>
</div>
<div id="localstorage" class="slide">
<h1>localStorage</h1>
<div class="figure">
<img src="images/06-storage.png" /><p class="caption"></p>
</div>
<p>There is another standard device API for storing simple string key-value pairs on the client: <em>localStorage</em>.</p>
<div id="however-we-need-to-store-more-than-strings...">
<h3>However, we need to store more than strings...</h3>
</div>
</div>
<div id="leaning-on-our-brothers-again" class="slide">
<h1>Leaning on our brothers again</h1>
<div id="lawnchair">
<h2>Lawnchair</h2>
<div class="figure">
<img src="images/06-lawnchair.png" /><p class="caption"></p>
</div>
<ul>
<li>Lawnchair is an open source, simple JSON storage utility that can store data on the client.</li>
<li>Several adapters are available for Lawnchair, including one that uses localStorage underneath (DOM adapter).</li>
</ul>
</div>
</div>
<div id="lets-kick-up-a-lawnchair-yeah" class="slide">
<h1>Let's kick up a Lawnchair, yeah?</h1>
<p>Instantiate the Lawnchair. Do this right after initializing the <code>zombies</code> array in the <code>zombieManager</code> function.</p>
<pre class="sourceCode"><code class="sourceCode javascript"><span class="kw">window</span>.<span class="fu">zombieManager</span> = (<span class="kw">function</span>() {<br />  <span class="kw">var</span> zombies       = <span class="kw">new</span> <span class="kw">Array</span>();<br />  <span class="kw">var</span> zombieChair   = Lawnchair({<span class="dt">name</span>: <span class="ch">'zombies'</span>}, <span class="kw">function</span>() {});</code></pre>
</div>
<div id="add-an-init-function" class="slide">
<h1>Add an init function</h1>
<p>We'll need a way for to call an initialization function when the page is ready, to get those dead zombies out of ice storage, into the <code>zombies</code> array and displayed:</p>
<div id="code-8">
<h2>Code</h2>
<pre class="sourceCode"><code class="sourceCode javascript"><span class="kw">return</span> {<br />  <span class="co">// Init; build initial #zombielist</span><br />  <span class="dt">init          </span>: <span class="kw">function</span>() {<br />    <span class="kw">zombieChair</span>.<span class="fu">get</span>(<span class="ch">'zombies'</span>, <span class="kw">function</span>(zombiesOnIce) {<br />      <span class="kw">if</span> (zombiesOnIce) {<br />        <span class="co">// If there are zombies stored, populate the </span><br />        <span class="co">// zombies array with those zombies</span><br />        zombies = <span class="kw">zombiesOnIce</span>.<span class="fu">value</span>;<br />      }<br />    });<br />    <span class="co">// Now, show the zombies</span><br />    showZombies();<br />  },<br />  <span class="co">// Add a new zombie to the list of zombies</span><br />  <span class="dt">addZombie     </span>: <span class="kw">function</span>(zombieWhen, zombieWhere, zombieHow) {<br />  <span class="co">// ...</span></code></pre>
</div>
</div>
<div id="update-the-addzombie-function..." class="slide">
<h1>...update the addZombie function...</h1>
<p>We need to store the zombie in the Lawnchair as well as the ephemeral array.</p>
<pre class="sourceCode"><code class="sourceCode javascript">  },<br />  <span class="co">// Add a new zombie to the list of zombies</span><br />  <span class="dt">addZombie     </span>: <span class="kw">function</span>(zombieWhen, zombieWhere, zombieHow) {<br />    zombies[<span class="kw">zombies</span>.<span class="fu">length</span>] = {<br />      <span class="dt">when      </span>: <span class="kw">zombieWhen</span>.<span class="fu">valueOf</span>(),<br />      <span class="dt">where     </span>: zombieWhere,<br />      <span class="dt">how       </span>: zombieHow<br />    };<br />    <span class="kw">zombieChair</span>.<span class="fu">save</span>({<span class="dt">key</span>: <span class="ch">'zombies'</span>, <span class="dt">value </span>: zombies });<br />    showZombies();<br />  }</code></pre>
</div>
<div id="update-the-resetzombies-function..." class="slide">
<h1>...update the resetZombies function...</h1>
<p>Nuke the contents of the Lawnchair as well as the array.</p>
<pre class="sourceCode"><code class="sourceCode javascript"><span class="kw">var</span> resetZombies = <span class="kw">function</span>() {<br />    zombies = <span class="kw">new</span> <span class="kw">Array</span>();<br />    <span class="kw">zombieChair</span>.<span class="fu">nuke</span>();<br />    $(<span class="ch">'li.zombie'</span>).<span class="fu">remove</span>();<br />    $(<span class="ch">'#zombielist'</span>).<span class="fu">listview</span>(<span class="ch">'refresh'</span>);<br />  };</code></pre>
</div>
<div id="and-add-a-call-to-the-init-function..." class="slide">
<h1>And add a call to the init function...</h1>
<div id="and-finally">
<h3>And finally</h3>
<p>When the jQM page and its widgets are ready to go, call that <code>init</code> function:</p>
<pre class="sourceCode"><code class="sourceCode javascript">$(<span class="st">&quot;#nab-zombie&quot;</span>).<span class="fu">live</span>(<span class="ch">'pageinit'</span>, <span class="kw">function</span>() {<br />  <span class="co">// Initialize our list of zombies</span><br />  <span class="kw">zombieManager</span>.<span class="fu">init</span>();<br />  <span class="co">// Is Geolocation supported?</span><br />  <span class="co">// ...</span></code></pre>
</div>
</div>
<div id="take-it-for-a-spin" class="slide">
<h1>Take it for a spin</h1>
<div id="figure-screen-shot-of-i-got-one">
<h2>Figure: Screen shot of I Got One!</h2>
<div class="figure">
<img src="images/06-screen.png" /><p class="caption"></p>
</div>
</div>
</div>
<div id="as-always-there-are-gotchas" class="slide">
<h1>As always, there are gotchas</h1>
<ul>
<li>Date objects don't unserialize correctly from Lawnchair (so we are storing a string representation of a Date object).</li>
<li>jQM <code>pagecreate</code> and <code>pageinit</code> events can be a bit tricky.</li>
</ul>
</div>
<div id="getting-the-final-mile" class="slide">
<h1>Getting the final mile</h1>
<p>Sometimes the zombies you face are not vulnerable to the mad skills you possess. Some things just aren't yet attainable on the mobile web, which is why <a href="07-desperate-times.html">desperate times call for desperate measures</a>.</p>
</div>
</body>
</html>
